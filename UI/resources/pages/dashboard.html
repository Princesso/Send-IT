<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="SendIT is a courier service that helps users deliver parcels to different destinations. SendIT provides courier quotes based on weight categories.">
  <meta name="keywords" content="SendIT, courier service, deliver parcels anywhere, courier quotes ">
  <meta name="author" description="Priness Oluebube Egbuna">
  <link rel="stylesheet" type="text/css" media="screen" href="../styles/dashboard.css" />
  <link rel="stylesheet" type="text/css" media="screen" href="../styles/main.css" />
  <link href="https://fonts.googleapis.com/css?family=Nanum+Gothic:100,300,400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css" integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns" crossorigin="anonymous">
</head>
<body>
  <div class="dashboard-container">
      <header class="header">
          <div><h1><a href="../../index.html">Send-It</a></h1></div>
          <nav>
            <ul>
              <li><a href="../../index.html">Home</a></li>
              <li><a href="#">Notification</a></li>
              <li><a href="../../index.html">Logout</a></li>
            </ul>
          </nav>
        </header>
        <section class="main-content">
          <div class="welcome">
            <h5>Welcome Princess</h5>
            <a href="../pages/new-order.html"><button id="new-delivery">New Delivery Order</button></a>
          </div>
          <div class="cards">
            <div class="card">
              <div id="delivery-truck">
                  <span class="fas fa-truck"></span>
              </div>
              <div>
                  <h6>Orders</h6>
                  <p>30</p>
              </div>
            </div>
            <div class="card">
                <div id="delivery-truck">
                    <span class="fas fa-check"></span>
                </div>
                <div>
                    <h6>Delivered</h6>
                    <p>10</p>
                </div>
            </div>
            <div class="card">
                <div id="delivery-truck">
                    <span class="fas fa-clock"></span>
                </div>
                <div>
                    <h6>Pending</h6>
                    <p>10</p>
                </div>
            </div>
            <div class="card">
                <div id="delivery-truck">
                    <span class="fas fa-ban"></span>
                </div>
                <div>
                    <h6>Canceled</h6>
                    <p>10</p>
                </div>
            </div>
          </div>
          <div id="all">
              All Orders
          </div>
          <div class="table-container">
            <table class="table" id="dashboard-table">
              <thead>
                <tr>
                    <th data-name="id">ID</th>
                    <th data-name="currentlocation">CURRENT LOCATION</th>
                    <th data-name="toaddress">DESTINATION</th>
                    <th data-name="status">STATUS</th>
                    <th data-name="action">ACTION</th>
                  </tr>
              </thead>

              <tbody>
                <tr>
                    <!-- <td>1</td>
                    <td>Shoes</td>
                    <td>1 kg bla</td>
                    <td>pending</td>
                    <td><a href="./order-detail.html"><button>View</button></a></td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td>Clothes</td>
                    <td>1 kg bla</td>
                    <td>Delivered</td>
                    <td><a href="./order-detail.html"><button>View</button></a></td>
                  </tr>
                  <tr>
                    <td>1</td>
                    <td>Bags</td>
                    <td>1 kg bla</td>
                    <td>pending</td>
                    <td><a href="./order-detail.html"><button>View</button></a></td>
                  </tr> -->
              </tbody>
            </table>
          </div>
        </section>
        <footer class="footer">
          <div><h1><a href="../../index.html">Send-It</a></h1></div>
            <nav>
              <ul>
                <li><a href="#">Contact</a></li>
                <li><a href="#">FAQs</a></li>
                <li><a href="#">Join our team</a></li>
              </ul>
            </nav>
        </footer> 
  </div>
  <script>
    fetch('http://localhost:8080/api/v1/users/1/parcels')
      .then(function(response) {
        return response.json();
      })
      .then((res) => {
        // we had stored the attributes to be filled in the rows using the data-attributes of the thead
        // so we grab the thead (for the data attributes)
        // and grab the tbody so we can append our new rows to them
        let tableHeadRef = document.getElementById('dashboard-table').getElementsByTagName('thead')[0]
        let tableRef = document.getElementById('dashboard-table').getElementsByTagName('tbody')[0]
        
        // we sort the data by id so it lines up neatly in asc order :)
        // then we iterate
        res.data.sort((d1, d2) => d1.id - d2.id).forEach(order => {

          // we create a new row on the body of the table
          let newRow   = tableRef.insertRow(tableRef.rows.length);

          // we want to create as many cells as there are on the header
          // notice we are leaving out the last row? For our button later :)
          for(var i = 0;i < tableHeadRef.rows[0].cells.length - 1;i++) {
            let newCell = newRow.insertCell(i);
            
            // text to be inserted in the cell?
            // the order is an object in the format {id: 1, currentlocation: 'lagos', toaddress: 'Aba', ...}
            // for the first cell in the header 
            let newText = document.createTextNode(order[tableHeadRef.rows[0].cells[i].dataset.name])
            newCell.appendChild(newText);
          }
          
          let btn = document.createElement('button');
          btn.innerText = 'View'
          let tag = document.createElement('a')
          tag.appendChild(btn)
          let newCell  = newRow.insertCell(i);
          newCell.appendChild(tag);
        })
      })
      .catch(error => console.error('Error:', error))
  </script>
</body>
</html>
